if("undefined"==typeof d3)throw"graphsimple.js: d3 library not loaded.";var gs={};gs.defaults={margeG:20,margeD:20,margeH:20,margeB:20,padG:0,padD:0,padH:0,padB:0,idPos:"center",annotateOnRight:!0,durAnim:1500,padPlage:5},gs.animer=function(t){t.curAnim<t.animations.length&&(t.animations[t.curAnim](),t.curAnim++)},gs.stat=function(t,i){var e="<table style='float:top'>";e+="<tr><td>P<small>A</small>CO₂:</td><td>"+Math.round(10*i[0].pAco2)/10+" mmHg</td></tr>",e+="<tr><td>P<small>E</small>CO₂:</td><td>"+Math.round(10*i[0].pmeco2)/10+" mmHg</td></tr>",e+="<tr><td>$\\frac{V_{EM}}{Vc}$ (Fowler):</td><td>"+Math.round(1e3*i[0].fowler)/10+" %</td></tr>",e+="<tr><td>$\\frac{V_{EM}}{Vc}$ (Bohr):</td><td>"+Math.round(1e3*i[0].bohr)/10+" %</td></tr>",e+="</table>",$(t).append(e)},gs.graph=class{constructor(t,i){this.idsvg=t;for(var e in gs.defaults){this[e]=gs.defaults[e]}for(var e in i){this[e]=i[e]}this.svg=d3.select(t).classed("gs",true);if("class"in this){this.svg.classed(this.class,true);console.log(this.class)}this.gridGroup=this.svg.append("g").attr("id","gridGroup");this.plageGroup=this.svg.append("g").attr("id","plageGroup");this.waveformGroup=this.svg.append("g").attr("id","waveformGroup");this.animations=[];this.anotations=[];this.plages=[];this.curAnim=0;this.width=this.svg.style("width");this.width=this.width.substr(0,this.width.length-2);this.height=this.svg.style("height");this.height=this.height.substr(0,this.height.length-2);this.defs=this.svg.append("defs");this.defs.append("marker").attr("id","flechep").attr("refY","7").attr("refX","7").attr("markerWidth","21").attr("markerHeight","14").attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("path").attr("d","M5,3 L9,7 L5,11");this.defs.append("marker").attr("id","fleches").attr("refY","7").attr("refX","14").attr("markerWidth","21").attr("markerHeight","14").attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("path").attr("d","M16,3 L12,7 L16,11");this.defs.append("marker").attr("id","flecheg").attr("refY","10").attr("refX","7").attr("markerWidth","21").attr("markerHeight","18").attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("path").attr("d","M3,5 L9,10 L3,15")}setscale(t,i,e){this.ymin=Math.min(d3.min(t,e),0);this.ymax=d3.max(t,e);this.xmin=d3.min(t,i);this.xmax=d3.max(t,i);if(this.padD!=0){this.xmax+=this.padD*(this.xmax-this.xmin)}if(this.padB!=0){this.ymin-=this.padB*(this.ymax-this.ymin)}if(this.padG!=0){this.xmin-=this.padG*(this.xmax-this.xmin)}if(this.padH!=0){this.ymax+=this.padH*(this.ymax-this.ymin)}this.echellex=d3.scale.linear().domain([this.xmin,this.xmax]).range([this.margeG+this.padG,this.width-(this.margeD+this.padD)]);this.echelley=d3.scale.linear().domain([this.ymin,this.ymax]).range([this.height-(this.margeB+this.padB),this.margeH+this.padH]);return this}getlf(t,i,e){this.lf=d3.svg.line().x(function(t){return this.echellex(i(t))}).y(function(t){return this.echelley(e(t))}).interpolate("linear")}getsf(t,i,e){this.sf=d3.svg.area().x(function(t){return this.echellex(i(t))}).y0(function(t){return this.echelley(0)}).y1(function(t){return this.echelley(e(t))}).interpolate("linear")}tracer(t,i,e){this.donnees=t;this.getlf(t,i,e);this.getsf(t,i,e);var s=this.donnees.map(function(t){return t.Time});this.animTime=Math.max(s)*1e3;var a=this.lf(t,i,e);var h=this.sf(t,i,e);if(!("gridY"in this)){this.drawGridY()}if(!("iridX"in this)){this.drawGridX()}if(!("waveformGroup"in this)){this.waveformGroup=this.svg.append("g").attr("id","waveformGroup")}this.clip=this.defs.append("clipPath").attr("id",this.idsvg+"clip");this.clipRect=this.clip.append("rect").attr("x",this.margeG+this.padG).attr("y",this.margeH+this.padH-2).attr("width",this.width-(this.margeD+this.margeG+this.padD+this.padG)+2).attr("height",this.height-(this.margeH+this.margeB+this.padH+this.padB)+2);this.surface=this.svg.append("path").attr("d",h).attr("class","surface").style("clip-path","url("+this.idsvg+"clip)");this.axes();this.courbe=this.waveformGroup.append("path").attr("d",a).style("clip-path","url("+this.idsvg+"clip)").classed("dataPath",true);return this}ajouter(t,i,e){this.getlf(t,i,e);this.getsf(t,i,e);var s=this.lf(t,i,e);this.courbe2=this.waveformGroup.append("path").attr("d",s).style("clip-path","url(#"+this.idsvg+"clip)").style("opacity",0).classed("dataPath",true);this.courbe2.transition().duration(this.durAnim).style("opacity",1);this.anotations.push(this.courbe2);return this}animate(){this.clipRect.attr("width",0);this.clipRect.transition().ease("linear").duration(this.animTime).attr("width",this.width-(this.margeD+this.margeG+this.padD+this.padG)+2);return this}raz(){for(i in this.anotations){this.anotations[i].transition().duration(this.durAnim).style("opacity",0);this.anotations[i].transition().delay(this.durAnim).remove()}for(i in this.plages){this.plages[i].ligne.transition().duration(this.durAnim).style("opacity",0);this.plages[i].texte.transition().duration(this.durAnim).style("opacity",0);this.plages[i].ligne.transition().delay(this.durAnim).remove();this.plages[i].texte.transition().delay(this.durAnim).remove()}}tracerZeroX(){console.log("tracerZeroX");this.ligneZeroX=this.svg.append("line").attr("x1",this.margeG).attr("x2",this.width-this.margeD).attr("y1",this.echelley(0)).attr("y2",this.echelley(0)).attr("class","ligneZero")}axes(){this.axex=this.svg.append("line").attr("x1",this.margeG).attr("x2",this.width-this.margeD).attr("y1",this.echelley(0)).attr("y2",this.echelley(0)).attr("class","axe");this.axey=this.svg.append("line").attr("x1",this.echellex(0)).attr("x2",this.echellex(0)).attr("y1",this.height-this.margeB).attr("y2",this.margeH).attr("class","axe");d3.selectAll(".axe").attr("style","marker-end: url(#flechep);")}zoomX(t,i){this.echellex=d3.scale.linear().domain([0,3]).range([this.margeG+this.padG,this.width-(this.margeD+this.padD)]);this.getlf(this.donnees,this.fx,this.fy);this.courbe.transition().duration(this.durAnim).attr("d",this.lf(this.donnees))}plagex(t,i,e){var s=this.padPlage;var a={};a.ligne=this.plageGroup.append("line").attr("x1",this.echellex(t)+s).attr("x2",this.echellex(i)-s).attr("y1",this.height-this.margeB*.5).attr("y2",this.height-this.margeB*.5).attr("class","help").attr("style","marker-start: url(#fleches);marker-end: url(#flechep);");a.rect=this.plageGroup.append("rect").attr("y",this.margeH).attr("x",this.echellex(t)).attr("width",this.echellex(i)-this.echellex(t)).attr("height",this.height-this.margeH-this.margeB);a.texte=this.svg.append("text").attr("class","help").attr("x",this.echellex(t+(i-t)/2)).attr("y",this.height-this.margeB*.3).attr("text-anchor","middle").text(e).attr("opacity",0);a.texte.transition().duration(this.durAnim).attr("opacity",1);this.plages.push(a);return this}plagey(t,i,e){var s=this.padPlage;var a={};a.ligneHaut=this.plageGroup.append("line").attr("y1",this.echelley(t+(i-t)/2)-s).attr("y2",this.echelley(t+(i-t)/2)-s).attr("class","help").attr("style","marker-end: url(#flechep);");a.ligneBas=this.plageGroup.append("line").attr("y2",this.echelley(t+(i-t)/2)+s).attr("y1",this.echelley(t+(i-t)/2)+s).attr("class","help").attr("style","marker-end: url(#flechep);");if(this.annotateOnRight==true){a.ligneHaut.attr("x1",this.width-this.margeD/2).attr("x2",this.width-this.margeD/2);a.ligneBas.attr("x1",this.width-this.margeD/2).attr("x2",this.width-this.margeD/2)}a.ligneHaut.transition().duration(this.durAnim).attr("y2",this.echelley(i)+s);a.ligneBas.transition().duration(this.durAnim).attr("y2",this.echelley(t)-s);a.rect=this.plageGroup.append("rect").attr("x",this.margeG).attr("y",this.echelley(i)).attr("width",this.width-this.margeD-this.margeG).attr("height",this.echelley(t)-this.echelley(i));a.texte=this.svg.append("text").attr("class","help").attr("y",this.echelley(t+(i-t)/2)).attr("x",this.width-this.margeD/2).attr("text-anchor","middle").text(e).attr("opacity",0);a.texte.transition().duration(this.durAnim).attr("opacity",1);this.plages.push(a);return this}setidx(t){var i=this.height-.2*this.margeB;if(this.idPos=="center"){var e=this.margeG+(this.width-this.margeD-this.margeG)/2;var s="middle"}else if(this.idPos=="end"){var e=this.width-this.margeD;var s="end"}this.idx=this.svg.append("text").attr("x",e).attr("y",i).attr("text-anchor",s).text(t);return this}texte(t,i,e){var s=this.svg.append("text").attr("text-anchor","middle").attr("x",this.echellex(t)).attr("y",this.echelley(i)).text(e)}setidy(t){if(this.idPos=="center"){var i=this.margeG/3;var e=this.margeH+(this.height-(this.margeB+this.margeH))/2;var s="middle";var a="rotate(-90 "+i+" "+e+")"}else if(this.idPos=="end"){var i=this.margeG+15;var e=this.margeH+10;var s="start"}this.idy=this.svg.append("text").attr("y",e).attr("x",i).attr("text-anchor",s).attr("transform",a).text(t);return this}pointy(t,i){var e=this.svg.append("line").attr("x1",this.margeG).attr("x2",this.margeG).attr("y1",this.echelley(t)).attr("y2",this.echelley(t)).attr("class","help");e.transition().duration(this.durAnim).attr("x2",this.width-this.margeD);this.anotations.push(e);var s=this.svg.append("text").attr("text-anchor","middle").attr("y",this.echelley(t)).attr("dy",0).attr("class","help").text(i);if(this.annotateOnRight==true){s.attr("x",this.width-this.margeD/2)}this.anotations.push(s);return this}pointx(t,i){var e=this.svg.append("line").attr("x1",this.echellex(t)).attr("x2",this.echellex(t)).attr("y1",this.echelley(this.ymax)).attr("y2",this.echelley(this.ymax)).attr("class","help");e.transition().duration(this.durAnim).attr("y1",this.echelley(this.ymin)-5);this.anotations.push(e);var e=this.svg.append("text").attr("y",this.height-this.margeB/3).attr("x",this.echellex(t)).attr("text-anchor","middle").text(i);this.anotations.push(e);return this}drawGridY(){this.gridY=d3.svg.axis().orient("left").tickSize(-(this.width-this.margeG-this.margeD)).scale(this.echelley);this.gridYGroup=this.gridGroup.append("g").attr("class","gridY").attr("transform","translate("+this.echellex(this.xmin)+", 0)").call(this.gridY);return this}drawGridX(){this.gridX=d3.svg.axis().tickSize(-(this.height-this.margeH-this.margeB-this.padH)).scale(this.echellex);this.gridXGroup=this.gridGroup.append("g").attr("class","gridX").attr("transform","translate(0, "+this.echelley(this.ymin)+")").call(this.gridX);return this}drawGradY(){this.gradY=d3.svg.axis().tickSize(20).scale(this.echelley);this.gradYGroup=this.svg.append("g").attr("class","gradY").attr("transform","translate("+this.echellex(this.xmin)+", 0)").call(this.gradY);return this}drawGradX(){this.gradX=d3.svg.axis().scale(this.echellex);this.gradXGroup=this.svg.append("g").attr("class","gradX").attr("transform","translate(0, "+this.echelley(this.ymin)+")").call(this.gradX);return this}playSimb(){this.svg.append("polygon").attr("class","playSimb").attr("points","0,0 0,50 43.3,25 0,0");return this}},gs.quickGraph=function(t,i,e,s,a){return new gs.graph(t,a).setscale(i,e,s).tracer(i,e,s)},gs.randomHue=function(t,i){var e=360*Math.random(),s="hsl( "+e+", "+t+"%, "+i+"% )";return s},gs.addGraph=function(t,i,e,s,a){var h=document.getElementsByTagName("svg").length+1,r=t+"SVG"+h,n=d3.select("#"+t).append("svg").attr("id",r);return"undefined"!=typeof a&&"class"in a&&n.classed(a["class"],!0),gs.quickGraph("#"+r,i,e,s,a)};