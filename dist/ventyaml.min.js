"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ventyaml=function(){function n(e){if(_classCallCheck(this,n),this.clsList=e.classList,!YAML)throw"ventyaml: YAML library not loaded.";this.parentDiv=e.parentNode,this.container=document.createElement("figure"),this.container.className=this.clsList,this.container.classList.add("ventyaml"),this.parentDiv.insertBefore(this.container,e),"TEXTAREA"==e.tagName?this.textarea=e:(this.textarea=document.createElement("textarea"),this.textarea.value=e.textContent,this.parentDiv.removeChild(e)),this.container.appendChild(this.textarea),this.textarea.classList.add("ventyamlSource"),this.container.classList.add("hidden"),this.textarea.value=this.textarea.value.trim(),this.waveformContainer=document.createElement("div"),this.waveformContainer.classList.add("vyamlwc");var t="vyamlwc"+(document.getElementsByClassName("vyamlwc").length+1);this.waveformContainer.id=t,this.container.insertBefore(this.waveformContainer,this.textarea),this.waveformContainer.addEventListener("click",this.toggleSource.bind(this)),this.downloadsDiv=document.createElement("div"),this.downloadsDiv.classList.add("downloads"),this.container.appendChild(this.downloadsDiv),this.update()}return _createClass(n,[{key:"setValue",value:function(e){this.textarea.value=e,"cm"in this&&(console.log("We have a codemirror instance"),this.cm.setValue(e))}},{key:"createCM",value:function(){void 0!==window.CodeMirror?this.cm=CodeMirror.fromTextArea(this.textarea,{theme:"midnight",mode:"yaml",matchBrackets:!0,showCursorWhenSelecting:!0}):console.log("Codemirror not available")}},{key:"update",value:function(){this.yaml=this.textarea.value,this.json=YAML.parse(this.yaml),this.updateLung(),this.updateVent(),this.run(),this.updateGraph(),this.updateCaption()}},{key:"updateVent",value:function(){if(this.vents=[],"Ventilateur"in this.json||"Ventilateurs"in this.json){if("Ventilateur"in this.json)this.vents.push(this.createvent(this.json.Ventilateur));else if("object"==_typeof(this.json.Ventilateurs))for(var e in this.json.Ventilateurs)this.vents.push(this.createvent(this.json.Ventilateurs[e]))}else this.vents.push(new sv.PressureControler)}},{key:"updateLung",value:function(){if(this.lungs=[],"Poumon"in this.json)this.lungs.push(this.createlung(this.json.Poumon));else if("Poumons"in this.json)for(var e in this.json.Poumons)this.lungs.push(this.createlung(this.json.Poumons[e]));else this.lungs.push(this.createlung("SimpleLung"))}},{key:"createvent",value:function(e){if("string"==typeof e){if(e in sv)var t=new sv[e]}else if("object"==(void 0===e?"undefined":_typeof(e))){if("Mode"in e)if(e.Mode in sv)t=new sv[e.Mode];else console.log("Does not seems to be a valid vent type");else var t=new sv.PressureControler;for(var n in e)"Mode"!==n&&"number"==typeof e[n]&&(t[n]=e[n])}if(void 0!==t)return t}},{key:"createlung",value:function(e){if("string"==typeof e){if(e in sv)var t=new sv[e]}else if("object"==(void 0===e?"undefined":_typeof(e))){if("Type"in e)if(e.Type in sv)t=new sv[e.Type];else console.log("Does not seems to be a valid lung type");else var t=new sv.SimpleLung;for(var n in e)"Type"!==n&&"number"==typeof e[n]&&(t[n]=e[n])}if(void 0!==t)return t}},{key:"run",value:function(){this.data=[];for(var e=this.downloadsDiv.children,t=0;t<e.length;t++)this.downloadsDiv.removeChild(e[t]);for(var t in this.vents){var n=this.vents[t];for(var t in this.lungs){n.time=0;var i=n.ventilate(this.lungs[t]).timeData;this.data.push(i);var s="object"!=(void 0===i?"undefined":_typeof(i))?JSON.parse(i):i,o="",a="";for(var r in s[0])""!=a&&(a+="\t "),a+=r;o+=a+"\r\n";for(t=0;t<s.length;t++){a="";for(var r in s[t])""!=a&&(a+="\t "),a+=s[t][r];o+=a+"\r\n"}var l=document.createElement("a");l.download="simvent"+this.data.length+".dat",l.href="data:text/tsv;charset=utf-8,"+escape(o),l.textContent=l.download+" ",this.downloadsDiv.appendChild(l)}}}},{key:"updateGraph",value:function(){for(var e=this.waveformContainer;e.firstChild;)e.removeChild(e.firstChild);if("Courbes"in this.json){var t=this.json.Courbes;if("object"==(void 0===t?"undefined":_typeof(t)))for(var n in t)this.createWaveform(t[n]);else console.log("ventyaml: Value for courbes must be a string list")}else"Courbe"in this.json&&this.createWaveform(this.json.Courbe);if("Boucles"in this.json)for(var n in this.json.Boucles)this.createLoop(this.json.Boucles[n]);else if("Boucle"in this.json){var i=this.json.Boucle;this.createLoop(i)}"Courbes"in this.json||"Courbe"in this.json||"Boucle"in this.json||"Boucles"in this.json||this.createWaveform("Flung")}},{key:"createWaveform",value:function(t){if("string"==typeof t){var e=function(e){return e.time},n=function(e){return e[t]},i=gs.addGraph(this.waveformContainer.id,this.data[0],e,n).setidx("Temps (s)").setidy(t);if(1<this.data.length)for(var s=1;s<this.data.length;s++)i.tracer(this.data[s],e,n)}else console.log("ventyaml: Value for courbes must be a string")}},{key:"createLoop",value:function(t){if("object"==(void 0===t?"undefined":_typeof(t))&&"x"in t&&"y"in t&&null!=t.x&&null!=t.y){var e=function(e){return e[t.x]},n=function(e){return e[t.y]},i=gs.addGraph(this.waveformContainer.id,this.data[0],e,n,{class:"loop"});if(i.setidx(t.x),i.setidy(t.y),1<this.data.length)for(var s=1;s<this.data.length;s++)i.tracer(this.data[s],e,n)}else console.log("ventyaml: invalid loop description")}},{key:"toggleSource",value:function(){this.container.classList.contains("hidden")?this.container.classList.remove("hidden"):(this.update(),this.container.classList.add("hidden"))}},{key:"updateCaption",value:function(){"Legende"in this.json&&(this.captionElement=document.createElement("caption"),this.captionElement.textContent=this.json.Legende,this.container.appendChild(this.captionElement))}}]),n}();function ventyamlEverything(e){var t=document.querySelectorAll(e);for(var n in t)if(void 0!==t[n].tagName)new ventyaml(t[n])}