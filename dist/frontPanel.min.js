"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fp={};for(language in fp.dygraphConf={includeZero:!0,strokeWidth:1,color:"hsl(220, 100%, 36%)",fillGraph:!1,drawGrid:!1,drawAxesAtZero:!0,digitsAfterDecimal:3,animatedZooms:!0,interactionModel:{},titleHeight:50,rightGap:100,axes:{x:{pixelsPerLabel:30,drawGrid:!1,axisLabelWidth:10},y:{pixelsPerLabel:15,drawGrid:!0,axisLabelWidth:35}},valueFormatter:function(e){return Math.round(1e3*e)/1e3}},fp.paramContainer="#panel",fp.waveformContainerID="#fpGraphics",fp.lungModels=["SimpleLung","SptLung","SygLung","RLung"],fp.lungModel="SimpleLung",fp.ventModels=["PressureAssistor","PressureControler","VDR","PVCurve","FlowControler"],fp.progressDelay=50,fp.languages={long:navigator.language,short:navigator.language.substr(0,2),fallback:"en"},fp.languages)console.log(language+": "+fp.languages[language]);function maj(){fp.panelDesactivate(),fp.initProgress(),setTimeout(function(){fp.updateModels(),fp.ventilate(),fp.xmin=null,fp.ymin=null,fp.plotDygraph(0)},50)}fp.translate1=function(e,t){return void 0!==dict[e]&&t in dict[e]&&navigator.language in dict[e][t]?dict[e][t][navigator.language]:void 0!==dict[e]&&t in dict[e]&&navigator.language in dict[e][t]?dict[e][t][navigator.language]:void 0!==dict[e]&&t in dict[e]&&navigator.language in dict[e][t]?dict[e][t][navigator.language]:(console.log('Was unable to translate "'+e+'"'),e)},fp.updateModels=function(){for(i in fp.ventilator.ventParams)1!=fp.ventilator.ventParams[i].calculated&&(fp.ventilator[i]=parseFloat($("#input"+i).val()));for(i in fp.ventilator.updateCalcParams(),fp.ventilator.ventParams)1==fp.ventilator.ventParams[i].calculated&&(document.getElementById("data"+i).textContent=""+Math.round(10*fp.ventilator[i])/10);for(i in fp.ventilator.simParams)fp.ventilator[i]=parseFloat($("#input"+i).val());for(i in fp.lung=new sv[fp.lungModel],fp.lung.mechParams)fp.lung[i]=parseFloat($("#input"+i).val())},fp.ventilate=function(){fp.ventilator.time=0,fp.data=fp.ventilator.ventilate(fp.lung),fp.timeData=fp.data.timeData},fp.download=function(e){var t="object"!=(void 0===e?"undefined":_typeof(e))?JSON.parse(e):e,n="",a="";for(var i in t[0])""!=a&&(a+="\t "),a+=i;n+=a+"\r\n";for(var o=0;o<t.length;o++){a="";for(var i in t[o])""!=a&&(a+="\t "),a+=t[o][i];n+=a+"\r\n"}var p=document.createElement("a");p.download="simvent.dat",p.href="data:text/csv;charset=utf-8,"+escape(n),document.body.appendChild(p),setTimeout(function(){p.click(),document.body.removeChild(p)},66)},fp.iSelect=function(){this.select()},fp.paramTable=function(e,t,n,a){if(void 0!==e[t]){null==document.getElementById("#"+a)&&$(n).append('<table id="'+a+'"></table>');var i=$("#"+a);for(id in e[t]){var o=e[t][id],p=fp.translate1(id,"short");if(void 0!==o.unit)var l=o.unit;else l="";var r=$("<tr></tr>"),d=$("<td></td>").attr("title",fp.translate1(id,"long")).html(p+" :").appendTo(r);d=$('<td class="data"></td>');if(1==o.calculated){var f=Math.round(10*fp.ventilator[id])/10;$("<span></span>").attr("id","data"+id).html(f).appendTo(d)}else $("<input></input>").attr("id","input"+id).attr("value",e[id]).attr("size","3").attr("type","number").attr("step",o.step).attr("onFocus","this.select()").appendTo(d);r.append(d);$("<td class='unit'>"+l+"</td>").appendTo(r);r.appendTo(i)}}},fp.graphics=[],fp.timeSeries=["Pao","Flung","Palv","Vt","PCO2"],fp.timeSeries2=[{id:"Pao",dataSets:[{dataSet:"timeData",key:"Pao"}]},{id:"Flung",dataSets:[{dataSet:"timeData",key:"Flung"}]},{id:"Palv",dataSets:[{dataSet:"timeData",key:"Palv"}]},{id:"PCOâ‚‚",dataSets:[{dataSet:"timeData",key:"PCO2"}]}],fp.initDyGraph=function(){for(index in $(".graph").detach(),fp.timeSeries){var e=fp.timeSeries[index];if(void 0!==dict[e])var t=fp.translate1(fp.timeSeries[index],"long");else t=e;var n=fp.dygraphConf;n.title=t,n.labels=["Time",e],$(fp.waveformContainerID).append("<div class='graph' id='graph"+e+"'></div>");var a=document.getElementById("graph"+e);fp.graphics.push(new Dygraph(a,[[0,0]],fp.dygraphConf))}fp.sync=Dygraph.synchronize(fp.graphics,{selection:!0,zoom:!0,range:!1})},fp.updateTSParam=function(){console.log(this.checked)},fp.mkTsSelect=function(){var e=[],t=sv.log(fp.lung,fp.ventilator);for(var n in delete t.time,t)e.push(n);for(var a in e=e.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})){var i=document.createElement("span"),o=document.createElement("input");o.type="checkbox",o.onChange=fp.updateTSParam,fp.timeSeries.includes(e[a])&&(o.checked=!0),i.appendChild(o);var p=document.createTextNode(" "+e[a]);i.appendChild(p),document.body.appendChild(i)}},fp.plotDygraph=function(e){var a=fp.timeSeries[e];var t=fp.timeData.map(function(e,t,n){return[e.time,e[a]]});fp.graphics[e].updateOptions({file:t}),fp.pBarr.value=(e+1)/fp.timeSeries.length,e<fp.timeSeries.length-1?(++e,setTimeout(function(){fp.plotDygraph(e)},10)):setTimeout(function(){fp.stopProgress()},50),fp.graphics[0].resetZoom()},fp.progressBar=function(){fp.pbTimer=setTimer(function(){},fp.pbDelay)},fp.initProgress=function(){document.querySelector(".fpShadow").classList.add("visible"),fp.pDiv=document.createElement("div"),fp.pDiv.id="pDiv",fp.pDiv.textContent="Updating graphics...",fp.pBarr=document.createElement("progress"),fp.pBarr.value=0,fp.pDiv.appendChild(fp.pBarr),document.body.appendChild(fp.pDiv)},fp.stopProgress=function(){setTimeout(function(){fp.hideShadow(),document.body.removeChild(fp.pDiv)},100)},fp.lungMenu=function(){var e=document.querySelector(fp.paramContainer),t=document.createElement("select");for(i in t.id="lungSelect",t.onchange=fp.lungChange,e.appendChild(t),fp.lungModels){var n=document.createElement("option");n.value=fp.lungModels[i],n.textContent=fp.lungModels[i],t.appendChild(n)}t.selectedIndex=fp.lungModels.indexOf(fp.lungModel)},fp.ventMenu=function(){var e=document.querySelector(fp.paramContainer),t=document.createElement("select");for(i in t.id="ventSelect",t.onchange=fp.ventChange,e.appendChild(t),fp.ventModels){var n=document.createElement("option");n.value=fp.ventModels[i],n.textContent=fp.ventModels[i],t.appendChild(n)}t.selectedIndex=fp.ventModels.indexOf(fp.ventModel)},fp.lungChange=function(){var e=document.getElementById("lungSelect"),t=e.options[e.selectedIndex].value;fp.lungModel=t,fp.lung=new sv[t],fp.init()},fp.ventChange=function(){var e=document.getElementById("ventSelect"),t=e.options[e.selectedIndex].value;fp.ventModel=t,fp.ventilator=new sv[t],fp.init()},fp.initShadow=function(){var e=document.createElement("div");e.className="fpShadow",e.onclick=function(){fp.panelDesactivate(),fp.hideShadow()},document.body.appendChild(e)},fp.hideShadow=function(){document.querySelector(".fpShadow").classList.remove("visible")},fp.initControls=function(){var e=document.querySelector("#fpControls");e.textContent=null;var t=document.createElement("img");t.src="../Icones/sliders.svg";var n=document.createElement("a");n.appendChild(t),n.onclick=fp.panelActivate,e.appendChild(n)},fp.init=function(){var e;void 0===fp.ventilator&&(fp.ventilator=new sv[fp.ventModel]),void 0===fp.lung&&(fp.lung=new sv[fp.lungModel]),fp.initControls(),$(fp.paramContainer).children().remove(),(e=document.createElement("h2")).textContent="Ventilateur",e.className="fpPanelTitle",document.querySelector("#panel").appendChild(e),fp.ventMenu(),fp.paramTable(fp.ventilator,"ventParams",fp.paramContainer,"Ventilateur"),(e=document.createElement("h2")).textContent="Poumon",e.className="fpPanelTitle",document.querySelector("#panel").appendChild(e),fp.lungMenu(),fp.paramTable(fp.lung,"mechParams",fp.paramContainer,"Poumon"),(e=document.createElement("h2")).textContent="Simulation",e.className="fpPanelTitle",document.querySelector("#panel").appendChild(e),fp.paramTable(fp.ventilator,"simParams",fp.paramContainer,"Simulation"),$(fp.paramContainer).append('<button id="ventiler" value="ventiler" onClick="maj()">&#x25b6; Ventiler</button>'),fp.initShadow(),fp.graphics=[],fp.initDyGraph(),maj(),$("#panel input").keypress(function(e){13==e.which&&$("#ventiler").click()}),$("input").change(function(){fp.updateModels()}),$("input").keyup(function(){fp.updateModels()})},fp.togglePanel=function(){document.querySelector(fp.paramContainer).classList.toggle("hidden")},fp.panelActivate=function(){document.querySelector(fp.paramContainer).scrollTop=0,document.querySelector(fp.paramContainer).classList.add("visible"),document.querySelector(".fpShadow").classList.add("visible")},fp.panelDesactivate=function(){console.log("panelDesactivate"),document.querySelector(fp.paramContainer).classList.remove("visible")};