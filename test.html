<!DOCTYPE html>

<meta charset="utf-8">

<script src="d3.min.js"></script>
<script src="jquery.min.js"></script>
<script src="jquery.flot.min.js"></script>
<script src="simvent.js"></script>
<script src="graphsimple.js"></script>

<link rel="stylesheet" type="text/css" href="graphsimple-clear.css" charset="utf-8" />

<style>

body {
padding:0px;
margin:0px;
}
.graph {
	height:175px;
	/*width:575px;*/
	width:100%;
}

#container {
	-moz-columns:400px 2;
	line-height:200%;
}

table {
	border-collapse:collapse;
	margin:auto;
}

td {
	padding:3px;
}
tr:nth-child(odd) {
		background-color: rgb(230, 230, 230);
	}

#panel {
	z-index:1;
	background-color:white;
	position:fixed;
	right:-200px;
	height:100%;
	box-shadow:0px 0px 10px;
	margin-top:0px;
	transition: all 1s ;
}

</style>


<div id="panel">
<table id="params"></table>
</div>

<div id="container">
	Phasitron input
	<div id="graph1" class="graph"></div>
	Phasitron output
	<div id="graph2" class="graph"></div>
	Presure at airway openning
	<div id="graph3" class="graph"></div>
	Lung Flow
	<div id="graph4" class="graph"></div>
	Alveolar presure
	<div id="graph5" class="graph"></div>
	Lung Volume
	<div id="graph6" class="graph"></div>
</div>


<script>
var flotConf = {
	yaxis:{labelWidth:30}
};
var lung = new sv.SimpleLung();
lung.Raw = 5;
var VDR = sv.VDR;
VDR.Tsampl=0.001;
VDR.Fiph=1.5;
VDR.Fipl=0.1;
VDR.Tvent=6;
VDR.Tip = 0.06;
VDR.Tep = 0.06;

var timeData = VDR.ventilate(lung).timeData;

//var timeData = [];
//VDR.percussiveInspiration(lung, 1.5);
//VDR.percussiveExpiration(lung);
//VDR.convectiveInspiration(lung);
//VDR.convectiveExpiration(lung);

$.plot("#graph1", [timeData.map(function(d){return [d.time, d.Fip]})], flotConf);
$.plot("#graph2", [timeData.map(function(d){return [d.time, d.Fop]}),timeData.map(function(d){return [d.time, d.Fip]})], flotConf);
$.plot("#graph3", [timeData.map(function(d){return [d.time, d.Pao]})], flotConf);
$.plot("#graph4", [timeData.map(function(d){return [d.time, d.Flung]})], flotConf);
$.plot("#graph5", [timeData.map(function(d){return [d.time, d.Palv]})], flotConf);
$.plot("#graph6", [timeData.map(function(d){return [d.time, d.Vt]})], flotConf);

var params = [
	"Tsampl",
	"Tip",
	"Fiph",
	"Fipl",
	"Tep"
];

for(i in params){
	$("#params").append("<tr><td>" + params[i] + " :  </td><td>" + VDR[params[i]] +"</td></tr>");
}

$(window).keypress(function(event){

	if (event.which == 109){
		var pos = $("#panel").css("right");
		if (pos == "0px"){
			$("#panel").css("right", -200);
		}
		else{
			$("#panel").css("right", 0);
		}

	}
});

</script>
